<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>EdgeGuard AI</title>

    <style>
        * {
            box-sizing: border-box;
            font-family: "Segoe UI", system-ui, sans-serif;
        }

        body {
            margin: 0;
            height: 100vh;
            background: radial-gradient(circle at top, #0f172a, #020617);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #e5e7eb;
        }

        .card {
            width: 420px;
            background: rgba(15, 23, 42, 0.85);
            border-radius: 18px;
            padding: 28px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(14px);
        }

        h1 {
            text-align: center;
            margin-bottom: 6px;
            font-size: 28px;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            font-size: 14px;
            opacity: 0.75;
            margin-bottom: 24px;
        }

        label {
            font-size: 14px;
            margin-bottom: 6px;
            display: block;
            opacity: 0.9;
        }

        select,
        input[type="file"] {
            width: 100%;
            background: #020617;
            color: #e5e7eb;
            border: 1px solid #1e293b;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 14px;
        }

        button {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: white;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.5);
        }

        audio {
            width: 100%;
            margin-top: 14px;
            display: none;
        }

        canvas {
            width: 100%;
            height: 90px;
            margin-top: 14px;
            display: none;
        }

        .result {
            margin-top: 18px;
            padding: 16px;
            border-radius: 14px;
            background: rgba(2, 6, 23, 0.85);
            display: none;
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 999px;
            font-weight: 700;
            font-size: 13px;
            margin-bottom: 10px;
        }

        .real {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .fake {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .footer {
            margin-top: 18px;
            text-align: center;
            font-size: 12px;
            opacity: 0.6;
        }
    </style>
</head>

<body>
    <div class="card">
        <h1>EdgeGuard AI</h1>
        <div class="subtitle">Offline Audio & Video Deepfake Detection</div>

        <label>Input Type</label>
        <select id="inputType">
            <option value="audio">Audio (.wav)</option>
        </select>

        <input type="file" id="fileInput" accept=".wav" />

        <button onclick="analyze()">Analyze</button>

        <!-- Audio Preview -->
        <audio id="audioPlayer" controls></audio>

        <!-- Waveform -->
        <canvas id="waveform"></canvas>

        <!-- Result -->
        <div class="result" id="resultBox">
            <div id="resultBadge" class="badge"></div>
            <div id="resultText"></div>
        </div>

        <div class="footer">Edge AI · Privacy-First · Fully Offline</div>
    </div>

<script>
const fileInput = document.getElementById("fileInput");
const audioPlayer = document.getElementById("audioPlayer");
const canvas = document.getElementById("waveform");
const ctx = canvas.getContext("2d");
const resultBox = document.getElementById("resultBox");
const resultBadge = document.getElementById("resultBadge");
const resultText = document.getElementById("resultText");

// Show audio + waveform on file select
fileInput.addEventListener("change", () => {
    const file = fileInput.files[0];
    if (!file) return;

    // Audio preview
    const url = URL.createObjectURL(file);
    audioPlayer.src = url;
    audioPlayer.style.display = "block";

    // Waveform
    const reader = new FileReader();
    reader.onload = async () => {
        const audioCtx = new AudioContext();
        const buffer = await audioCtx.decodeAudioData(reader.result);
        drawWaveform(buffer.getChannelData(0));
    };
    reader.readAsArrayBuffer(file);
});

function drawWaveform(data) {
    canvas.style.display = "block";
    canvas.width = canvas.offsetWidth;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = "#3b82f6";
    ctx.lineWidth = 1;

    const step = Math.ceil(data.length / canvas.width);
    const amp = canvas.height / 2;

    ctx.beginPath();
    for (let i = 0; i < canvas.width; i++) {
        let min = 1.0;
        let max = -1.0;
        for (let j = 0; j < step; j++) {
            const v = data[i * step + j];
            if (v < min) min = v;
            if (v > max) max = v;
        }
        ctx.moveTo(i, (1 + min) * amp);
        ctx.lineTo(i, (1 + max) * amp);
    }
    ctx.stroke();
}

// Analyze button
async function analyze() {
    const file = fileInput.files[0];
    if (!file) {
        alert("Please select an audio file");
        return;
    }

    const formData = new FormData();
    formData.append("file", file);

    const response = await fetch("http://127.0.0.1:8000/analyze-audio", {
        method: "POST",
        body: formData
    });

    const data = await response.json();

    resultBox.style.display = "block";
    resultBadge.textContent = data.prediction;
    resultBadge.className = "badge " + (data.prediction === "REAL" ? "real" : "fake");

    resultText.innerHTML = `
        <strong>Confidence:</strong> ${data.confidence}%<br>
        <strong>Engine:</strong> ${data.engine}<br>
        <strong>Mode:</strong> ${data.mode}
    `;
}
</script>
</body>
</html>
